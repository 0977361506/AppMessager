<!DOCTYPE html>
<html lang="en">
<head>
  <title>Messager</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
  <link rel="stylesheet" href="/css/index.css">
  <script src='/socket.io/socket.io.js'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</head>
<body > 
    <div class="row main">
       <div class="container-fluid">
                <div class="row justify-content-between">
                    <div class="col col-sm-4" style="padding-bottom: 5px;">
                        <input type="hidden" id="user" value="<%= user.username %>"/>
                        <div class="d-flex">
                            <div class="image-container">
                                <img src="https://i.pinimg.com/564x/79/0d/29/790d29ac20dc5fc7cd5c2a61cbddb9f7.jpg" title="ảnh face book " style="max-width: 38px; max-height: 39px; border-radius: 50%;"  />
                             </div>
     
                             <div class="input-search" style="padding-left: 10px;">
                                <span class="glyphicon glyphicon-search"></span>
                                <input class="form-control input-search" type="text" placeholder="Tìm kiếm trên facebook" style="background: #3a3b3c; border: none !important;">
                             </div>  
                        </div>
                    </div>
                    <div class="col col-sm-5">
                        <div class="row">
                           <div class="col col-sm-2">
                              <i class="fas fa-home"></i>
                           </div>

                           <div class="col col-sm-2">
                                <i class="fas fa-tv"></i>
                            </div>

                            <div class="col col-sm-2">
                                <i class="fas fa-archive"></i>
                            </div>
                            
                            <div class="col col-sm-2">
                                <i class="fas fa-church"></i>
                            </div>

                            <div class="col col-sm-2">
                                <i class="fas fa-dice-d6"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col col-sm-2">
                        <div class="row">
                           <div class="col col-sm-5">
                               <img src="https://study.vnpost.vn/static/images/user_techer.png"
                               style="    width: 50%;
                               max-width: 20px;
                               max-height: 20px;
                               border-radius: 50%;" />
                               <label style="color: white; width: 50%;" ><%= user.username %></label>
                           </div>
                           <div class="col col-sm-2">
                            <i class="fas fa-dice-six"></i>
                           </div>
                           <div class="col col-sm-2">
                            <i class="fas fa-bell"></i>
                            </div>
                            <div class="col col-sm-2">
                             
                                <i class="fas fa-caret-down"></i>
                            </div>  
                        </div>
                    </div>
                </div>
       </div>

       <!-- content message -->
       <div class="container-fluid  main-chat"> 

            <div class="row">
              <div class="col col-sm-3"  id="left-content">

                <div class="row friend" >
                    <div class="col col-sm-12">
                        <div class="d-flex justify-content-between">
                            <div class="image-user">
                                <h3 style="color: white;">Chat</h3>
                            </div>
                            <div style="padding-left: 10px">
                                <i style='font-size:22px' class='fas'>&#xf044;</i>
                            </div>
                        </div>
                    </div>
                    <div class="col col-sm-12">
                         <i class="fas fa-search"><span style="font-size: 15px;">  &nbsp; Tìm kiếm trên messager</span></i>
                         <input class="form-control  input-search" style="background: #3a3b3c; border: none !important;"/>
                    </div>
                 </div>

                 
                <div class=" row friend video-container" >
                    <video autoplay class="remote-video" id="remoteVideo" style="width: 165px;"></video>
                    <video autoplay muted class="local-video" id="localVideo" style="width: 165px;"></video>
                </div>

                <div class="listUser">

                </div>

              </div>

              <div class="col col-sm-9" id="right-content">
                 <div class="row friend">
                     <div class="col col-sm-10">
                        <div class="d-flex">
                            <div class="image-user">
                                <img src="https://study.vnpost.vn/static/images/user_techer.png"
                                style="max-width:40px ; max-height :40px; border-radius: 50%;" />
                            </div>
                            <div style="padding-left: 10px">
                                <p style="font-size: 0.875rem ; color: white; margin: 0px;" id="chatWithUser">Phương Anh</p>
                                <p style="font-size: 10px; color: white ; margin: 0px;">Hoạt động 10 phút trước</p>
                            </div>
                        </div>
                     </div>
                     <div class="col col-sm-2">
                        <div class="row">
                            <div class="col col-sm-4" >
                                <!-- <i class="fa fa-phone icon" aria-hidden="true" data-toggle="modal" data-target="#callVideo" onclick="call()"></i> -->
                                <i class="fa fa-phone icon"  id="call" aria-hidden="true" ></i>
                            </div>
 
                            <div class="col col-sm-4">
                                <i class="fa fa-camera icon" aria-hidden="true"></i>
                             </div>
 
                             <div class="col col-sm-4">
                                <i  class="fa icon">&#xf071;</i>
                             </div>
                             
                        
                         </div>
                     </div>
                 </div>

                 <div class="row main-chats">
                    <div class="col col-sm-12 contentchat" id="contentchat" style="overflow-y: scroll;
                    position: relative;
                    height: 550px;">
                        <div class="d-flex justify-content-start comment-user">
                            <div class="message">
                                <div class="d-flex">
                                    <div class="image-user">
                                        <img src="https://study.vnpost.vn/static/images/user_techer.png"
                                        style="max-width:40px ; max-height :40px; border-radius: 50%;" />
                                    </div>
                                    <div style="padding-left: 10px" class="list-comment-user">
                                        <p class="message-f-user" >Helo chị phương anh xinh đẹp của chú </p>
                                        <p  class="message-f-user">Cháu đang làm gi thế </p>
                                        <p   class="message-f-user">Cháu nay không đi làm à ! </p>
                                   </div>
                            </div>
                            </div>
                       </div>


                        <div class="d-flex justify-content-end comment-you">
                            <div class="message">
                                <div class="d-flex">
                                    <!-- <div class="image-user">
                                        <img src="https://scontent.fhan14-2.fna.fbcdn.net/v/t1.6435-1/cp0/p80x80/176368141_1193350064449159_5082408654114027829_n.jpg?_nc_cat=102&ccb=1-3&_nc_sid=7206a8&_nc_ohc=Zpn2S34cOicAX9d0Sx4&_nc_ht=scontent.fhan14-2.fna&oh=eefab7227b21d7d6f7be5d31985f31dd&oe=60FD41DD"
                                        style="max-width:40px ; max-height :40px; border-radius: 50%;" />
                                    </div> -->
                                    <div style="padding-left: 10px" class="list-comment-user">
                                        <p class="message-f-you">Chào chá</p>
                                        <p class="message-f-you">Nay chú không đi làm  Nay chú không đi làm Nay chú không đi làm Nay chú không đi làm  </p>
                                        <p class="message-f-you">Chú ở nhà</p>
                                </div>
                            </div>
                            </div>
                        </div>
                 </div>

                 <div class="col col-sm-12 message">
                    <input type="file" id="sendding" style="visibility: hidden;display:none">
                     <div class="row">
                        <div class="col col-sm-2">
                           <div class="d-flex" style="padding-top:5px;">
                              <div>
                                <i class="fas fa-plus iconChat" style="   color: rgb(0, 132, 255) !important;
                                font-size: 24px !important;
                                margin-left: 24px !important;"></i>
                              </div>
                              <div>
                                <i class="far fa-images iconChat" style="   color: rgb(0, 132, 255) !important;
                                font-size: 24px !important;
                                margin-left: 10px !important;" id="sendAllFile"></i>
                              </div>
                              <div>
                                <i class="far fa-smile-wink iconChat" style="   color: rgb(0, 132, 255) !important;
                                font-size: 24px !important;
                                margin-left: 10px !important;"></i>
                              </div>
                              <div>
                                <i class="fas fa-gift iconChat" style="   color: rgb(0, 132, 255) !important;
                                font-size: 24px !important;
                                margin-left: 10px !important;"></i>
                              </div>
                           </div>
                        </div>
                        <div class="col col-sm-9">
                           <input id="sendMessage" type="text" placeholder="Nhập tin nhắn của bạn ..." class="form-control" style="    border-radius: 24px;
                           background-color: var(--web-wash);"/>
                        </div>
                        <div class="col col-sm-1">
                            <div style="padding-top:5px;">
                                <i class="far fa-thumbs-up" style="   color: rgb(0, 132, 255) !important;
                                font-size: 27px !important;
                                margin-left: 10px !important"></i>
                            </div>
                        </div>
                     </div>
                 </div>

              </div>
            </div>
       </div>
    </div>



    <div id="modalCall" class="modal fade" role="dialog">
        <div class="modal-dialog modal-xl">
      
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="row">
                   <div class="col col-sm-12">
                      <video autoplay class="remote-video" id="remote-video" style="max-height: 255px;   width: 1100px;"></video>
                   </div>
                   <div class="col col-sm-12">
                    <video autoplay muted class="local-video" id="local-video" style="max-height: 255px;   width: 1100px;"></video>
                   </div>
                   <div class="col col-sm-12">
                      <div class="d-flex justify-content-center">
                         <div class="list_icon">
                            <div class="d-flex" style="padding-top:5px;">
                                <div>
                        
                                  <i class="far fa-copy iconChat" style="    margin-right: 58px;
                                  color: rgb(0, 132, 255) !important;
                                  font-size: 30px !important;"></i>
                                </div>
                                <div>
                                  <i  class="fa fa-camera iconChat" aria-hidden="true" style="      margin-right: 58px;
                                  color: rgb(0, 132, 255) !important;
                                  font-size: 30px !important;"></i>
                                  
                                </div>
                                <div>
                                  <i class="fas fa-volume-down iconChat" style="      margin-right: 58px;
                                  color: rgb(0, 132, 255) !important;
                                  font-size: 30px !important;"></i>
                    
                                </div>
                                <div>
                                  <i class="fas fa-phone iconChat" style="    margin-right: 58px;
                                  color: rgb(0, 132, 255) !important;
                                  font-size: 30px !important;"></i>
                        
                                </div>
                             </div> 
                         </div>
                      </div>
                   </div>
                </div>
            </div>
            
          </div>
      
        </div>
      </div>


      <div id="modalAnswer" class="modal fade" role="dialog">
        <div class="modal-dialog ">
      
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                   <button class="btn btn-sm btn-primary" id="answer" >Trả lời</button>
                </div>
            </div>
            
          </div>
      
        </div>
      </div>


</body>
<script src="/js/scriptForIndexChat.js"></script>
<script>
    
    // let isAlreadyCalling = false;

    // let getCalled = false;

    // const existingCalls = [];

    // const { RTCPeerConnection, RTCSessionDescription } = window;

    // const peerConnection = new RTCPeerConnection();
    
    // const socket = io.connect("localhost:3333"); 

//     async function callUser(e) {
        
//         let socketId = $(e).attr("id");
//         console.log(socketId)
//         const offer = await peerConnection.createOffer();
//         await peerConnection.setLocalDescription(new RTCSessionDescription(offer));

//         socket.emit("call-user", {
//             offer,
//             to: socketId
//         });
//     }


    

//   socket.on("call-made", async data => {
//     console.log(data)
//     if (getCalled) {
//       const confirmed = confirm(
//         `User "Socket: ${data.socket}" wants to call you. Do accept this call?`
//       );
  
//       if (!confirmed) {
//         socket.emit("reject-call", {
//           from: data.socket
//         });
  
//         return;
//       }
//     }
  
//     await peerConnection.setRemoteDescription(
//       new RTCSessionDescription(data.offer)
//     );
    
//     const answer = await peerConnection.createAnswer();
//     await peerConnection.setLocalDescription(new RTCSessionDescription(answer));
  
//     socket.emit("make-answer", {
//       answer,
//       to: data.socket
//     });
//     getCalled = true;
//   });
  
//   socket.on("answer-made", async data => {
//     await peerConnection.setRemoteDescription(
//       new RTCSessionDescription(data.answer)
//     );
  
//     if (!isAlreadyCalling) {
//       callUser(data.socket);
//       isAlreadyCalling = true;
//     }
//   });
  
  
  
  
//   socket.on("call-rejected", data => {
//     alert(`User: "Socket: ${data.socket}" rejected your call.`);

//   });
  
//   peerConnection.ontrack = function({ streams: [stream] }) {
//     const remoteVideo = document.getElementById("remote-video");
//     if (remoteVideo) {
//       remoteVideo.srcObject = stream;
//     }
//   };
  
//   navigator.getUserMedia(
//     { video: true, audio: true },
//     stream => {
//       const localVideo = document.getElementById("local-video");
//       if (localVideo) {
//         localVideo.srcObject = stream;
//       }
  
//       stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));
//     },
//     error => {
//       console.warn(error.message);
//     }
//   );
  



</script>
</html>
